<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="net.edu.module.dao.ArchiveAssessDao">

    <insert id="insertArchiveAccess">
        insert into archive_assess (name,target_id,course_id,deleted,create_time)
        values (#{name},#{targetId},#{firstKnowledgeId},0,now())
    </insert>

    <select id="selectArchiveAssessByPage" resultType="net.edu.module.vo.ArchiveAssessVO">
        SELECT
        t1.id AS id,
        t1.name AS name ,
        t3.target_id AS targetId,
        t3.course_id AS courseId,
        t3.weight AS weight,
        ( SELECT name FROM archive_target t2 WHERE t3.target_id = t2.id ) AS targetName,
        ( SELECT name FROM archive_course t4 WHERE t3.course_id = t4.id ) AS courseName,
        ( SELECT grade FROM archive_target t2 WHERE t3.target_id = t2.id ) AS grade,
        t3.weight_explain AS weightExplain,
        t1.creator,
        t1.version,
        t1.updater
        FROM
        archive_assess t1
        JOIN archive_weight_target_assess t3
        WHERE
        t1.deleted = 0
        AND t1.id = t3.assess_id
        <if test="query.getName()!=null and query.getName()!=''">
            and name like concat('%',#{query.name},'%')
        </if>
        <if test="query.getGrade()!=null and query.getGrade()!=''">
            and ( SELECT grade FROM archive_target t2 WHERE t3.target_id = t2.id) = #{query.grade}
        </if>
        <if test="query.getTargetName()!=null and query.getTargetName()!=''">
            and ( SELECT name FROM archive_target t2 WHERE t3.target_id = t2.id ) like concat('%',#{query.targetName},'%')
        </if>
        <if test="query.getFirstKnowledgeName()!=null and query.getFirstKnowledgeName()!=''">
            and ( SELECT name FROM archive_course t4 WHERE t3.course_id = t4.id ) like concat('%',#{query.courseName},'%')
        </if>
        order by t1.id desc
    </select>
</mapper>
