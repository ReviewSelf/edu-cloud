<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="net.edu.module.dao.ArchiveTargetDao">
    <insert id="insertArchiveTarget">
        insert into archive_target
            (graduate_id, name, content, grade, creator, create_time)
        values (#{graduateId},#{name},#{content},#{grade},"10000",now())
    </insert>

    <select id="selectArchiveTargetByPage" resultType="net.edu.module.vo.ArchiveTargetVO">
        SELECT
	        id,
            graduate_id AS graduateId,
            name,
            content,
            version,
            updater,
            grade,
            (select title from archive_graduate_require t1 where t1.id=t2.graduate_id) as graduateTitle
        FROM
            archive_target t2
        WHERE
            deleted =0
        <if test="query.getName()!='' and query.getName()!=null">
            and  name like concat('%',#{query.name},'%')
        </if>
        <if test="query.getGrade()!='' and query.getGrade()!=null">
            and grade = #{query.grade}
        </if>
        <if test="query.getGraduateTitle()!='' and query.getGraduateTitle()!=null">
            and graduateTitle like concat('%',#{query.graduateTitle},'%')
        </if>
        order by id desc
    </select>
    <select id="selectName" resultType="net.edu.module.vo.ArchiveTargetVO">
        SELECT
            id,
            name
        FROM
	        archive_target
	    where
	        deleted=0 and grade=#{grade}
    </select>

    <select id="selectArchiveTargetById" resultType="net.edu.module.vo.ArchiveTargetVO">
        SELECT
        id,
        graduate_id AS graduateId,
        name,
        content,
        version,
        updater,
        grade,
        (select title from archive_graduate_require t1 where t1.id=t2.graduate_id) as graduateTitle
        FROM
        archive_target t2
        WHERE
        id = #{id}
    </select>

    <select id="selectArchiveTargetByGraduateId" resultType="net.edu.module.vo.ArchiveTargetVO">
        SELECT
            id,
            graduate_id AS graduateId,
            name,
            content,
            grade,
            (select title from archive_graduate_require t1 where t1.id=t2.graduate_id) as graduateTitle
        FROM
            archive_target t2
        WHERE
            graduate_id = #{graduateId}
    </select>

    <update id="updateArchiveTarget">
        update archive_target
        set name = #{name},content = #{content},grade = #{grade},graduate_id = #{graduateId}
        where id = #{id}
    </update>

    <update id="updateDeleted">
        update archive_target set deleted = 1
        where graduate_id = #{graduateId}
    </update>
</mapper>
