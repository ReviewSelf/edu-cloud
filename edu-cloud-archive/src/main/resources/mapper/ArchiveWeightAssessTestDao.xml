<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="net.edu.module.dao.ArchiveWeightAssessTestDao">
    <insert id="insertTestWeight" parameterType="java.util.List">
            replace into archive_weight_assess_test
            (source,test_id,assess_id,weight) values
        <foreach collection="list" item="item"  separator=",">
            ("考试",#{item.testId},#{item.assessId},#{item.weight})
        </foreach>
    </insert>
    <update id="updateDeleted">
        update archive_weight_assess_test set deleted = 1
        where test_id = #{testId}
    </update>
    <select id="selectTestName" resultType="net.edu.module.vo.ArchiveWeightAssessTestVO">
        select
            id,
            test_id as testId,
            assess_id as assessId,
            (select name from exam t1 where t1.id = testId) as name,
            weight
        from archive_weight_assess_test
        where deleted = 0 and assess_id = #{assessId}
    </select>
    <select id="selectArchiveTestAll" resultType="net.edu.module.vo.ArchiveWeightAssessTestVO">
        SELECT
            id,
            name
        FROM
	        exam
        WHERE
            deleted = 0
            AND class_id IN (
            SELECT
                id
            FROM
                teach_class
            WHERE
                deleted = 0
            AND plan_id = ( SELECT teach_plan_id FROM archive_course WHERE deleted = 0 AND id = ( SELECT course_id FROM archive_weight_target_assess WHERE assess_id = #{assessId} AND deleted = 0 ) )
            )
    </select>


</mapper>
