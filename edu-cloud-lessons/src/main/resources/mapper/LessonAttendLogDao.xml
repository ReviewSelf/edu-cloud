<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="net.edu.module.dao.LessonAttendLogDao">

    <resultMap type="net.edu.module.entity.LessonAttendLogEntity" id="lessonAttendLogMap">
        <result property="id" column="id"/>
        <result property="stuId" column="stu_id"/>
        <result property="lessonId" column="lesson_id"/>
        <result property="checkinTime" column="checkin_time"/>
        <result property="status" column="status"/>
        <result property="rollCall" column="roll_call"/>
        <result property="createTime" column="create_time"/>
        <result property="updateTime" column="update_time"/>
    </resultMap>
    <insert id="insertUserList">
        insert ignore into lesson_attend_log(stu_id,lesson_id,status,roll_call)
        values
        <foreach collection="list" item="item" separator=",">
            (
            #{item},#{lessonId},-1,0
            )
        </foreach>
    </insert>

    <insert id="insertLessonList">
        insert ignore into lesson_attend_log(stu_id,lesson_id,status,roll_call)
        values
        <foreach collection="list" item="item" separator=",">
            (
            #{stuId},#{item},-1,0
            )
        </foreach>
    </insert>


    <delete id="deleteLessonList">
        delete from lesson_attend_log
        where stu_id = #{stuId} and lesson_id in
        <foreach collection="list" item="item" separator="," open="(" close=")">
            #{item}
        </foreach>
    </delete>

    <select id="selectStudentsList" resultType="net.edu.module.vo.LessonAttendLogVO">
        select a.id,
               stu_id       as stuId,
               b.real_name  as name,
               lesson_id    as lessonId,
               checkin_time as checkinTime,
               roll_call    as rollCall,
               a.status
        from lesson_attend_log a
                 left join sys_user b on a.stu_id = b.id
        where lesson_id = #{query.lessonId}
        order by roll_call
    </select>

    <update id="updateStudents">
        update lesson_attend_log set stu_id = #{vo.stuId}
        <if test="vo.getId()!=null">
            ,id = #{vo.id}
        </if>
        <if test="vo.getStatus()!=null">
            ,status = #{vo.status}
        </if>
        <if test="vo.getCheckinTime()!=null">
            ,checkin_time = #{vo.checkinTime}
        </if>
        <if test="vo.getRollCall()!=null">
            ,roll_call = #{vo.rollCall}
        </if>
        <if test="vo.getUpdateTime()!=null">
            ,update_time = #{vo.updateTime}
        </if>
        where stu_id = #{vo.stuId} and lesson_id = #{vo.lessonId}

    </update>


</mapper>