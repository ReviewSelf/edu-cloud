<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="net.edu.module.dao.LessonDao">

    <resultMap type="net.edu.module.entity.LessonEntity" id="lessonMap">
        <result property="id" column="id"/>
        <result property="teacherId" column="teacher_id"/>
        <result property="name" column="name"/>
        <result property="classId" column="class_id"/>
        <result property="place" column="place"/>
        <result property="beginTime" column="begin_time"/>
        <result property="endTime" column="end_time"/>
        <result property="createTime" column="create_time"/>
        <result property="updateTime" column="update_time"/>
        <result property="status" column="state"/>
        <result property="creator" column="creator"/>
        <result property="updater" column="updater"/>
        <result property="deleted" column="deleted"/>
    </resultMap>
    <select id="selectStudentPage" resultType="net.edu.module.vo.LessonVO">
        select t.id,t.teacher_id as teacherId,name,status,(select name from sys_user where id=t.teacher_id) as teacherName,t.class_id as classId,(select name from teach_class where id=t.class_id) as className,t.place,t.begin_time as beginTime,t.end_time as endTime   from lesson t
        where exists (select 1 from teach_class a join teach_class_user b on a.id=b.class_id and b.user_id=#{query.userId}
            where a.id=t.class_id)

        <if test="query.getName()!=null and query.getName()!=''">
            and name like concat('%',#{query.name},'%')
        </if>
        <if test="query.getClassId()!=null">
            and t.class_id=#{query.classId}
        </if>
    </select>

    <select id="selectTeacherPage" resultType="net.edu.module.vo.LessonVO">
        select t.id,t.teacher_id as teacherId,name,status,(select name from sys_user where id=t.teacher_id) as teacherName,t.class_id as classId,(select name from teach_class where id=t.class_id) as className,t.place,t.begin_time as beginTime,t.end_time as endTime   from lesson t
        where exists (select 1 from teach_class a where (a.teacher1_id=#{query.userId} or a.teacher2_id=#{query.userId})
        and a.id=t.class_id)
        <if test="query.getName()!=null and query.getName()!=''">
            and name like concat('%',#{query.name},'%')
        </if>
        <if test="query.getClassId()!=null">
            and t.class_id=#{query.classId}
        </if>
    </select>

</mapper>