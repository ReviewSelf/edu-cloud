<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="net.edu.module.dao.ChoiceProblemDao">
    <select id="selectChoiceProblem" resultType="net.edu.module.vo.ChoiceProblemVO">
<!--        select id,type,name,description,source,tips,advice_time,img,difficulty,kp_id as kpId-->
<!--               ,(select name from knowledge_point where id=kp_id limit 1) as kpName,submit_times-->
<!--               ,correct_times as correctTimes,is_typical as isTypical,option_num as optionNum,used_num as usedNum,-->
<!--                -->
<!--        from problem_choice where deleted = 0-->
<!--        order by status asc,update_time desc-->
    </select>

<!--    <select id="selectChoicePage" resultType="net.edu.module.vo.ChoiceProblemVO">-->
<!--                select pc.id,type,pc.name,pc.description,source,tips,advice_time,img,difficulty,kp_id-->
<!--                       ,kp.name as kp_name,submit_times-->
<!--                       ,correct_times ,is_typical ,option_num ,used_num from problem_choice pc-->
<!--                        left join knowledge_point kp on kp.id =pc.kp_id-->

<!--    </select>-->

    <select id="page" resultType="net.edu.module.vo.ChoiceProblemVO">
        select id,type,name,description,source,tips,advice_time as adviceTime,img,difficulty,kp_id as kpId
        ,(select name from knowledge_point where id=kp_id limit 1) as kpName,submit_times as submitTimes
        ,correct_times as correctTimes,is_typical as isTypical,option_num as optionNum,used_num as usedNum,
        create_time as createTime,creator,status
        from problem_choice where deleted = 0
        <if test="query.getType()!=null">
            and  type = #{query.type}
        </if>
        <if test="query.getName()!='' and query.getName()!=null">
            and  name like concat('%',#{query.name},'%')
        </if>
        <if test="query.getDifficulty()!=null">
            and difficulty =#{query.difficulty}
        </if>
        <if test="query.getKpId()!=null">
            and kp_id = #{query.kpId}
        </if>
        <if test="query.getStatus()!=null">
            and status = #{query.status}
        </if>
        <if test="query.getIsTypical()!=null">
            and status = #{query.isTypical}
        </if>
        order by status asc,update_time desc
    </select>

    <update id="updateStatus" >
        update problem_choice set status=abs(status-1) where id=#{id}
    </update>
</mapper>