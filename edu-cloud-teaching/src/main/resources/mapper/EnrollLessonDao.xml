<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="net.edu.module.dao.EnrollLessonDao">
    <insert id="saveLesson" parameterType="net.edu.module.entity.EnrollLessonEntity">
        insert into
        lesson(teacher_id , name , place , begin_time , end_time , class_id , plan_item_id)
        values(#{teacherId}, #{name} , #{place} , #{beginTime} , #{endTime} , 0 , #{planItemId})
    </insert>
    <insert id="joinLessonSys" parameterType="net.edu.module.entity.EnrollUserEntity">
        insert into
        sys_user(username , real_name , mobile , union_id , open_id , area , age , grade , version , integral , balance , password)
        values(#{wxName} , #{name} , #{phone} , #{unionId} , #{openId} , #{area} , #{age} , #{grade} , #{version} , #{integral} , #{balance} , '123456')
    </insert>
    <update id="updateLesson" parameterType="net.edu.module.vo.EnrollLessonVO">
        update
        lesson set teacher_id = #{teacherId} , name = #{name}, place = #{place} , begin_time = #{beginTime} , plan_item_id = #{planItemId}, end_time = #{endTime}
        where id = #{id}
    </update>
    <update id="joinLesson">
        update
        enroll_user set status = 3
        where id = #{id}
    </update>
    <select id="selectEnrollLessonByPage" resultType="net.edu.module.vo.EnrollLessonVO">
        select
        t1.id,
        t1.name,
        t1.teacher_id,
        t1.place,
        t1.plan_item_id,
        t3.name as planItemName,
        t1.begin_time,
        t1.end_time,
        t2.real_name
        from lesson t1
        left join sys_user t2 on t1.teacher_id = t2.id
        left join teach_plan_item t3 on t1.plan_item_id = t3.id
        where t1.deleted = 0 and t1.class_id = 0
    </select>
    <select id="selectLessonById" resultType="net.edu.module.entity.EnrollLessonEntity">
        select
        t1.id,
        t1.name,
        t1.teacher_id,
        t1.place,
        t1.begin_time,
        t1.end_time,
        t2.real_name
        from lesson t1
        left join sys_user t2 on t1.teacher_id = t2.id
        where t1.id = #{id}
    </select>
    <select id="SelectOne" resultType="net.edu.module.entity.EnrollSelectOne">
        select
        id,
        username
        from sys_user
    </select>


</mapper>
