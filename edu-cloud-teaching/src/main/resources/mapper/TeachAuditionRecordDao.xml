<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="net.edu.module.dao.TeachAuditionRecordDao">

    <resultMap type="net.edu.module.entity.TeachAuditionRecordEntity" id="teachAuditionRecordMap">
        <result property="id" column="id"/>
        <result property="studentId" column="student_id"/>
        <result property="classId" column="class_id"/>
        <result property="teacherId" column="teacher_id"/>
        <result property="dateTime" column="date_time"/>
        <result property="status" column="status"/>
        <result property="createTime" column="create_time"/>
        <result property="version" column="version"/>
        <result property="updateTime" column="update_time"/>
        <result property="creator" column="creator"/>
        <result property="updater" column="updater"/>
        <result property="deleted" column="deleted"/>
    </resultMap>

    <select id="selectAuditionRecordPage" resultType="net.edu.module.entity.TeachAuditionRecordEntity">
        select t.student_id as studentId,(select real_name from sys_user where id = t.student_id) as studentName,t.lesson_id as lessonId,
               (select name from lesson where id = t.lesson_id) as lessonName,
               t.date_time as dateTime,t.status from teach_audition_record t where deleted = 0
                <if test="query.getStudentName!=null and query.getStudentName!=''">
                   and studentName like concat('%',#{query.studentName},'%')
                </if>
                <if test="query.getLessonName!=null and query.getLessonName!=''">
                   and lessonName like concat('%',#{query.lessonName},'%')
                </if>
                <if test="query.getStatus!=null ">
                   and status = #{query.status}
                </if>
                order by status , dateTime desc
    </select>

    <insert id="insertLessonAttendLog">
        insert into lesson_attend_log(stu_id,lesson_id) values(#{vo.studentId},#{vo.lessonId})
    </insert>


</mapper>