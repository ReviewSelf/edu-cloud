<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="net.edu.module.dao.TeachClassDao">

    <resultMap type="net.edu.module.entity.TeachClassEntity" id="teachClassMap">
        <result property="id" column="id"/>
        <result property="name" column="name"/>
        <result property="description" column="description"/>
        <result property="img" column="img"/>
        <result property="planId" column="plan_id"/>
        <result property="lessonNum" column="lesson_num"/>
        <result property="lessonTime" column="lesson_time"/>
        <result property="frequency" column="frequency"/>
        <result property="status" column="status"/>
        <result property="beginTime" column="begin_time"/>
        <result property="endTime" column="end_time"/>
        <result property="teacher1Id" column="teacher1_id"/>
        <result property="teacher2Id" column="teacher2_id"/>
        <result property="nextLessson" column="next_lessson"/>
        <result property="createTime" column="create_time"/>
        <result property="updateTime" column="update_time"/>
        <result property="deleted" column="deleted"/>
        <result property="updater" column="updater"/>
        <result property="creator" column="creator"/>
        <result property="version" column="version"/>
    </resultMap>

    <select id="page" resultType="net.edu.module.vo.TeachClassVO">
        select
        id,
        name,
        description,
        img,plan_id as planId,
        lesson_num as lessonNum,
        frequency,
        status,
        lesson_begin_time as lessonBeginTime,
        lesson_end_time as lessonEndTime,
        begin_time as beginTime,
        end_time as endTime,
        teacher1_id as teacher1Id,
        teacher2_id as teacher2Id,
        place,
        (select real_name from sys_user where id=teacher1Id) as teacher1Name,
        (select real_name from sys_user where id=teacher2Id) as teacher2Name
        from teach_class
        where deleted =0
        <if test="query.getName()!=null and query.getName()!=''">
            and  name like concat('%',#{query.name},'%')
        </if>
        order by lesson_num desc,id desc
    </select>


    <select id="selectClassForStudent" resultType="net.edu.module.vo.TeachClassVO">
        SELECT a.status,
        a.id,
        a.name,
        end_time as endTime,
        teacher1_id as teacher1Id,
        teacher2_id as teacher2Id,
        (select real_name FROM sys_user WHERE id = teacher1_id) as teacher1Name,
        (select real_name FROM sys_user WHERE id = teacher2_id) as teacher2Name,
        next_lessson as nextLessson,
        frequency
        from teach_class a
        LEFT JOIN teach_class_user b on a.id = b.class_id and b.user_id = #{userId}
        <if test="status!=null">
            and status=#{status}
        </if>
    </select>

    <select id="selectClassForTeacher" resultType="net.edu.module.vo.TeachClassVO">
        SELECT a.status,
        a.id,
        a.name,
        end_time as endTime,
        teacher1_id as teacher1Id,
        teacher2_id as teacher2Id,
        (select real_name FROM sys_user WHERE id = teacher1_id) as teacher1Name,
        (select real_name FROM sys_user WHERE id = teacher2_id) as teacher2Name,
        next_lessson as nextLessson,
        frequency
        from teach_class a
        where a.teacher1_id=#{userId} or a.teacher2_id=#{userId}
        <if test="status!=null">
            and status=#{status}
        </if>
    </select>


</mapper>
