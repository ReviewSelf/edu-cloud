<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="net.edu.module.dao.TeachClassUserDao">

    <resultMap type="net.edu.module.entity.TeachClassUserEntity" id="teachClassUserMap">
        <result property="id" column="id"/>
        <result property="classId" column="class_id"/>
        <result property="userId" column="user_id"/>
        <result property="joinLessonTimes" column="join_lesson_times"/>
        <result property="quitLessonTimes" column="quit_lesson_times"/>
        <result property="joinTime" column="join_time"/>
        <result property="quitTime" column="quit_time"/>
        <result property="status" column="status"/>
        <result property="lateTimes" column="late_times"/>
        <result property="homeworkTimes" column="homework_times"/>
        <result property="unfinishedProblemNum" column="unfinished_problem_num"/>
        <result property="paymentAmount" column="payment_amount"/>
        <result property="paymentTimes" column="payment_times"/>
        <result property="paymentTrue" column="payment_true"/>
        <result property="createTime" column="create_time"/>
        <result property="updateTime" column="update_time"/>
        <result property="deleted" column="deleted"/>
        <result property="updater" column="updater"/>
        <result property="creator" column="creator"/>
        <result property="version" column="version"/>
    </resultMap>

    <update id="updateQuitClass">
        update teach_class_user set quit_time=#{quitTime} ,status = 2 where user_id = #{userId} and class_id = #{classId}
    </update>
    <insert id="insertClassUser" parameterType="net.edu.module.entity.TeachClassUserEntity">
        INSERT INTO teach_class_user
        (user_id,class_id)
        VALUES
        <foreach collection="list" item="item" separator=",">
            (#{item},#{classId})
        </foreach>
    </insert>
    <select id="selectUserIdList" resultType="java.lang.Long">
        select user_id from teach_class_user where  class_id = #{classId} and deleted=0 and status=1
    </select>
    <select id="selectStudent" resultType="net.edu.module.entity.TeachStudentEntity">
        select
        t1.user_id as userId,
        t1.class_id as classId,
        t2.username
        from teach_class_user t1
        left join sys_user t2 on t1.user_id = t2.id
        where t1.class_id = #{id}
    </select>
</mapper>
